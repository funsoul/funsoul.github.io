<!DOCTYPE html>
<html lang=ch>
<head><meta name="generator" content="Hexo 3.9.0">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="Impala的SQL语法参考https://www.cloudera.com/documentation/enterprise/latest/topics/impala_langref_sql.html PHP通过Thrift连接Impala安装thrift服务 Thrift最初由Facebook开发用做系统内各语言之间的RPC通信. Thrift是一款可伸缩跨语言的服务开发框架, 该框架已经开源">
<meta name="keywords" content="PHP,impala">
<meta property="og:type" content="article">
<meta property="og:title" content="详解PHP连接Impala安装与配置">
<meta property="og:url" content="http://funsoul.org/2017/12/08/详解PHP连接Impala安装与配置/index.html">
<meta property="og:site_name" content="funsoul">
<meta property="og:description" content="Impala的SQL语法参考https://www.cloudera.com/documentation/enterprise/latest/topics/impala_langref_sql.html PHP通过Thrift连接Impala安装thrift服务 Thrift最初由Facebook开发用做系统内各语言之间的RPC通信. Thrift是一款可伸缩跨语言的服务开发框架, 该框架已经开源">
<meta property="og:locale" content="chinese">
<meta property="og:updated_time" content="2019-06-21T03:15:13.781Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="详解PHP连接Impala安装与配置">
<meta name="twitter:description" content="Impala的SQL语法参考https://www.cloudera.com/documentation/enterprise/latest/topics/impala_langref_sql.html PHP通过Thrift连接Impala安装thrift服务 Thrift最初由Facebook开发用做系统内各语言之间的RPC通信. Thrift是一款可伸缩跨语言的服务开发框架, 该框架已经开源">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>详解PHP连接Impala安装与配置</title>
    <!-- styles -->
    <link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/lib/meslo-LG/styles.css">
    <link rel="stylesheet" href="/lib/justified-gallery/justifiedGallery.min.css">
    <link rel="stylesheet" href="/css/style.css">
    <!-- rss -->
    
    
    <!-- jquery -->
    <script src="/lib/jquery/jquery.min.js"></script>
</head>

<body>
    <div class="banner">
<div id="blogtitel" class="blogtitel">funsoul</div>
<ul id="wrapper" class="wrapper">
  <div class="sun">
    <div class="star"></div>
  </div>
  <div class="mercury">
    <div class="planet">
      <div class="shadow"></div>
    </div>
  </div>
  <div class="venus">
    <div class="planet">
      <div class="shadow"></div>
    </div>
  </div>
  <div class="earth">
    <div class="planet"><div class="shadow"></div></div>
  </div>
  <div class="mars">
    <div class="planet"><div class="shadow"></div></div>
  </div>
  <div class="jupiter">
    <div class="planet"><div class="shadow"></div></div>
  </div>
</ul>
</div>

    <div class="background">
      
        <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="https://github.com/funsoul">Projects</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2017/12/14/【问题排查】PHP-FPM模式下提示缺失lib/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li>
        
        
        <li><a class="icon" href="/2017/12/05/安装impala-shell遇到的问题/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://funsoul.org/2017/12/08/详解PHP连接Impala安装与配置/"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://funsoul.org/2017/12/08/详解PHP连接Impala安装与配置/&text=详解PHP连接Impala安装与配置"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://funsoul.org/2017/12/08/详解PHP连接Impala安装与配置/&title=详解PHP连接Impala安装与配置"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://funsoul.org/2017/12/08/详解PHP连接Impala安装与配置/&is_video=false&description=详解PHP连接Impala安装与配置"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=详解PHP连接Impala安装与配置&body=Check out this article: http://funsoul.org/2017/12/08/详解PHP连接Impala安装与配置/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://funsoul.org/2017/12/08/详解PHP连接Impala安装与配置/&title=详解PHP连接Impala安装与配置"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://funsoul.org/2017/12/08/详解PHP连接Impala安装与配置/&title=详解PHP连接Impala安装与配置"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://funsoul.org/2017/12/08/详解PHP连接Impala安装与配置/&title=详解PHP连接Impala安装与配置"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://funsoul.org/2017/12/08/详解PHP连接Impala安装与配置/&title=详解PHP连接Impala安装与配置"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://funsoul.org/2017/12/08/详解PHP连接Impala安装与配置/&name=详解PHP连接Impala安装与配置&description="><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Impala的SQL语法参考"><span class="toc-number">1.</span> <span class="toc-text">Impala的SQL语法参考</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP通过Thrift连接Impala"><span class="toc-number">2.</span> <span class="toc-text">PHP通过Thrift连接Impala</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#安装thrift服务"><span class="toc-number">2.1.</span> <span class="toc-text">安装thrift服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#检查是否安装成功"><span class="toc-number">2.2.</span> <span class="toc-text">检查是否安装成功</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#impala的SQL查询参考"><span class="toc-number">2.3.</span> <span class="toc-text">impala的SQL查询参考</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#连接PHP例子参考"><span class="toc-number">2.4.</span> <span class="toc-text">连接PHP例子参考</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使PHP通过ODBC连接Impala-方法1"><span class="toc-number">3.</span> <span class="toc-text">使PHP通过ODBC连接Impala(方法1)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#安装ODBC相关软件包以及ImpalaODBC驱动"><span class="toc-number">3.1.</span> <span class="toc-text">安装ODBC相关软件包以及ImpalaODBC驱动</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#系统版本"><span class="toc-number">3.1.1.</span> <span class="toc-text">系统版本</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用ODBC连接数据库-分为两个主要部分"><span class="toc-number">3.2.</span> <span class="toc-text">使用ODBC连接数据库, 分为两个主要部分:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ClouderaImpalaODBC到Cloudera官网下载"><span class="toc-number">3.3.</span> <span class="toc-text">ClouderaImpalaODBC到Cloudera官网下载:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#若已安装其他版本则先卸载原来安装的"><span class="toc-number">3.4.</span> <span class="toc-text">若已安装其他版本则先卸载原来安装的</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#增加环境变量-注意重启后失效-可在-etc-profile里面改使永久生效"><span class="toc-number">3.5.</span> <span class="toc-text">增加环境变量(注意重启后失效, 可在/etc/profile里面改使永久生效)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#动态编译pdo-odbc扩展"><span class="toc-number">3.6.</span> <span class="toc-text">动态编译pdo-odbc扩展</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#动态编译odbc扩展"><span class="toc-number">3.7.</span> <span class="toc-text">动态编译odbc扩展</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改-etc-odbc-ini替换为如下-注意！！下文所有的配置文件的每行都一定要保持左对齐！"><span class="toc-number">3.8.</span> <span class="toc-text">修改/etc/odbc.ini替换为如下:(注意！！下文所有的配置文件的每行都一定要保持左对齐！)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改-etc-odbcins-ini替换为如下"><span class="toc-number">3.9.</span> <span class="toc-text">修改/etc/odbcins.ini替换为如下:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改-etc-cloudera-impalaodbc-ini"><span class="toc-number">3.10.</span> <span class="toc-text">修改/etc/cloudera.impalaodbc.ini</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#测试连接impala"><span class="toc-number">3.11.</span> <span class="toc-text">测试连接impala</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP通过ODBC连接Impala-方法2"><span class="toc-number">4.</span> <span class="toc-text">PHP通过ODBC连接Impala(方法2)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#安装ODBC相关软件包以及ImpalaODBC驱动-1"><span class="toc-number">4.1.</span> <span class="toc-text">安装ODBC相关软件包以及ImpalaODBC驱动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#新建存放配置的目录"><span class="toc-number">4.2.</span> <span class="toc-text">新建存放配置的目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建环境变量文件common-env"><span class="toc-number">4.3.</span> <span class="toc-text">创建环境变量文件common.env</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建配置odbc-odbc-ini"><span class="toc-number">4.4.</span> <span class="toc-text">创建配置odbc/odbc.ini</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建配置odbc-odbcinst-ini"><span class="toc-number">4.5.</span> <span class="toc-text">创建配置odbc/odbcinst.ini</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建配置odbc-cloudera-impalaodbc-ini"><span class="toc-number">4.6.</span> <span class="toc-text">创建配置odbc/cloudera.impalaodbc.ini</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建配置cloudera-hiveodbc-ini"><span class="toc-number">4.7.</span> <span class="toc-text">创建配置cloudera.hiveodbc.ini</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#进行测试"><span class="toc-number">4.8.</span> <span class="toc-text">进行测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#运行php进行测试"><span class="toc-number">4.9.</span> <span class="toc-text">运行php进行测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#php常用ODBC函数集"><span class="toc-number">5.</span> <span class="toc-text">php常用ODBC函数集</span></a></li></ol>
    </div>
  </span>
</div>

      
      <div class="content index width mx-auto px2 my4">
          
          <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        详解PHP连接Impala安装与配置
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">funsoul</span>
      </span>
      
    <div class="postdate">
        <time datetime="2017-12-07T16:00:00.000Z" itemprop="datePublished">2017-12-08</time>
    </div>


      
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/PHP/">PHP</a>, <a class="tag-link" href="/tags/impala/">impala</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h3 id="Impala的SQL语法参考"><a href="#Impala的SQL语法参考" class="headerlink" title="Impala的SQL语法参考"></a>Impala的SQL语法参考</h3><p><a href="https://www.cloudera.com/documentation/enterprise/latest/topics/impala_langref_sql.html" target="_blank" rel="noopener">https://www.cloudera.com/documentation/enterprise/latest/topics/impala_langref_sql.html</a></p>
<h3 id="PHP通过Thrift连接Impala"><a href="#PHP通过Thrift连接Impala" class="headerlink" title="PHP通过Thrift连接Impala"></a>PHP通过Thrift连接Impala</h3><h4 id="安装thrift服务"><a href="#安装thrift服务" class="headerlink" title="安装thrift服务"></a>安装thrift服务</h4><ul>
<li>Thrift最初由Facebook开发用做系统内各语言之间的RPC通信.</li>
<li>Thrift是一款可伸缩跨语言的服务开发框架, 该框架已经开源并且加入的Apache项目.</li>
<li>Thrift主要功能是: 通过自定义的Interface Definition Language(IDL), 可以创建基于RPC的客户端和服务端的服务代码.</li>
<li>数据和服务代码的生成是通过Thrift内置的代码生成器来实现的, Thrift的跨语言性体现在:它可以生成C++/Java/Python/PHP/Ruby/Erlang/Perl/Haskell/C#/Cocoa/JavaScript/Node.js/Smalltalk/OCaml/Delphi等语言的代码,且它们之间可以进行透明的通信.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost tools]<span class="comment"># rpm -ivh thrift-0.9.0-28.1.i686.rpm</span></span><br><span class="line"></span><br><span class="line">warning: thrift-0.9.0-28.1.i686.rpm: Header V3 DSA/SHA1 Signature, key ID a949b429: NOKEY</span><br><span class="line">error: Failed dependencies:</span><br><span class="line">libc.so.6 is needed by thrift-0.9.0-28.1.i686</span><br><span class="line">libc.so.6(GLIBC_2.0) is needed by thrift-0.9.0-28.1.i686</span><br><span class="line">libc.so.6(GLIBC_2.1) is needed by thrift-0.9.0-28.1.i686</span><br><span class="line">libc.so.6(GLIBC_2.1.3) is needed by thrift-0.9.0-28.1.i686</span><br><span class="line">libc.so.6(GLIBC_2.3) is needed by thrift-0.9.0-28.1.i686</span><br><span class="line">libc.so.6(GLIBC_2.3.4) is needed by thrift-0.9.0-28.1.i686</span><br><span class="line">libc.so.6(GLIBC_2.4) is needed by thrift-0.9.0-28.1.i686</span><br><span class="line">libgcc_s.so.1 is needed by thrift-0.9.0-28.1.i686</span><br><span class="line">libgcc_s.so.1(GCC_3.0) is needed by thrift-0.9.0-28.1.i686</span><br><span class="line">libm.so.6 is needed by thrift-0.9.0-28.1.i686</span><br><span class="line">libstdc++.so.6 is needed by thrift-0.9.0-28.1.i686</span><br><span class="line">libstdc++.so.6(CXXABI_1.3) is needed by thrift-0.9.0-28.1.i686</span><br><span class="line">libstdc++.so.6(CXXABI_1.3.1) is needed by thrift-0.9.0-28.1.i686</span><br><span class="line">libstdc++.so.6(GLIBCXX_3.4) is needed by thrift-0.9.0-28.1.i686</span><br><span class="line">libstdc++.so.6(GLIBCXX_3.4.11) is needed by thrift-0.9.0-28.1.i686</span><br><span class="line">libstdc++.so.6(GLIBCXX_3.4.9) is needed by thrift-0.9.0-28.1.i686</span><br><span class="line"></span><br><span class="line"><span class="comment">#报错, 缺少相关依赖.</span></span><br><span class="line"><span class="comment">#解决libc.so.6依赖:</span></span><br><span class="line"></span><br><span class="line">[root@localhost tools]<span class="comment"># yum list glibc*</span></span><br><span class="line">[root@localhost tools]<span class="comment"># yum install glibc.i686</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#解决libgcc_s.so.1依赖:到https://rpmfind.net/linux/rpm2html/search.php?query=libgcc_s.so.1下载相关依赖rpm包</span></span><br><span class="line"></span><br><span class="line">[root@localhost tools]<span class="comment"># rpm -ivh libgcc-4.4.7-18.el6.x86_64.rpm</span></span><br><span class="line">[root@localhost tools]<span class="comment"># rpm -ivh libgcc-4.4.7-18.el6.i686.rpm</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#解决libstdc++.so.6依赖:</span></span><br><span class="line"><span class="comment">#到https://rpmfind.net/linux/rpm2html/search.php?query=libstdc++.so.6下载相关依赖rpm包</span></span><br><span class="line"></span><br><span class="line">[root@localhost tools]<span class="comment"># rpm -ivh libstdc++-4.4.7-18.el6.i686.rpm</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#最后重新安装即可:</span></span><br><span class="line">[root@localhost tools]<span class="comment"># rpm -ivh thrift-0.9.0-28.1.i686.rpm</span></span><br><span class="line">        warning: thrift-0.9.0-28.1.i686.rpm: Header V3 DSA/SHA1 Signature, key ID a949b429: NOKEY</span><br><span class="line">        Preparing...                <span class="comment">########################################### [100%]</span></span><br><span class="line">           1:thrift                 <span class="comment">########################################### [100%]</span></span><br></pre></td></tr></table></figure>
<h4 id="检查是否安装成功"><a href="#检查是否安装成功" class="headerlink" title="检查是否安装成功"></a>检查是否安装成功</h4><p>a. 首先创建Thrift的语法规则文件, 命名为server.thrift, 内容如下:</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">struct message</span><br><span class="line">&#123;</span><br><span class="line">    i32 seqId,</span><br><span class="line">    <span class="built_in">string</span> content</span><br><span class="line">&#125;</span><br><span class="line">service serDemo</span><br><span class="line">&#123;</span><br><span class="line">    void <span class="keyword">put</span>(message msg)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>b. 然后shell下执行命令:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># thrift -gen php server.thrift</span></span><br></pre></td></tr></table></figure>
<p>该语句用于创建php服务框架, 创建成功后会在该目录下生成gen-php文件夹.</p>
<h4 id="impala的SQL查询参考"><a href="#impala的SQL查询参考" class="headerlink" title="impala的SQL查询参考"></a>impala的SQL查询参考</h4><p><a href="http://www.cloudera.com/documentation/archive/impala/2-x/2-1-x/topics/impala_select.html" target="_blank" rel="noopener">http://www.cloudera.com/documentation/archive/impala/2-x/2-1-x/topics/impala_select.html</a></p>
<h4 id="连接PHP例子参考"><a href="#连接PHP例子参考" class="headerlink" title="连接PHP例子参考"></a>连接PHP例子参考</h4><p><a href="https://github.com/Automattic/php-thrift-sql" target="_blank" rel="noopener">https://github.com/Automattic/php-thrift-sql</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># git clone https://github.com/Automattic/php-thrift-sql.git</span></span><br><span class="line"><span class="comment"># cd php-thrift-sql/</span></span><br><span class="line"><span class="comment"># php -c php.ini build.php  【重新生成ThriftSQL.phar文件】</span></span><br><span class="line"><span class="comment"># vim test.php</span></span><br></pre></td></tr></table></figure>
<p>内容如下:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// Load this lib</span></span><br><span class="line"><span class="keyword">require_once</span> <span class="keyword">__DIR__</span> . <span class="string">'/ThriftSQL.phar'</span>;</span><br><span class="line"><span class="comment">// 1.Try out a Hive query</span></span><br><span class="line">$hive = <span class="keyword">new</span> \ThriftSQL\Hive(<span class="string">'192.168.8.207'</span>, <span class="number">21050</span>);</span><br><span class="line">$hiveTables = $hive</span><br><span class="line">    -&gt;setSasl(<span class="keyword">false</span>) <span class="comment">// To turn SASL auth off, on by default</span></span><br><span class="line">    -&gt;connect()</span><br><span class="line">    -&gt;queryAndFetchAll(<span class="string">'SHOW TABLES'</span>);</span><br><span class="line">print_r($hiveTables);</span><br><span class="line"><span class="comment">// 2.Try out an Impala query</span></span><br><span class="line">$impala = <span class="keyword">new</span> \ThriftSQL\Impala(<span class="string">'192.168.8.207'</span>);</span><br><span class="line">$impalaTables = $impala</span><br><span class="line">    -&gt;connect()</span><br><span class="line">    -&gt;queryAndFetchAll(<span class="string">'SHOW TABLES'</span>);</span><br><span class="line">print_r($impalaTables);</span><br><span class="line"><span class="comment">// 3.Try out an Impala query</span></span><br><span class="line">$impalaDatas = $impala</span><br><span class="line">    -&gt;connect()</span><br><span class="line">    -&gt;queryAndFetchAll(<span class="string">'select * from db_mcfx_log.t_log_sdk_log_user'</span>);</span><br><span class="line">print_r($impalaDatas);</span><br><span class="line"><span class="comment">// 4.Don't forget to clear the client and close socket.</span></span><br><span class="line">$hive-&gt;disconnect();</span><br><span class="line">$impala-&gt;disconnect();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后执行test.php</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># php test.php</span></span><br></pre></td></tr></table></figure>
<h3 id="使PHP通过ODBC连接Impala-方法1"><a href="#使PHP通过ODBC连接Impala-方法1" class="headerlink" title="使PHP通过ODBC连接Impala(方法1)"></a>使PHP通过ODBC连接Impala(方法1)</h3><h4 id="安装ODBC相关软件包以及ImpalaODBC驱动"><a href="#安装ODBC相关软件包以及ImpalaODBC驱动" class="headerlink" title="安装ODBC相关软件包以及ImpalaODBC驱动"></a>安装ODBC相关软件包以及ImpalaODBC驱动</h4><h5 id="系统版本"><a href="#系统版本" class="headerlink" title="系统版本"></a>系统版本</h5><p>centos6，别用centos7，很多lib不兼容，经常会看到这样的错误，解决起来非常棘手，即使下载安装了i686相关的包也不行。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">libxxx()(64bit) is needed by xxx</span><br></pre></td></tr></table></figure>
<h4 id="使用ODBC连接数据库-分为两个主要部分"><a href="#使用ODBC连接数据库-分为两个主要部分" class="headerlink" title="使用ODBC连接数据库, 分为两个主要部分:"></a>使用ODBC连接数据库, 分为两个主要部分:</h4><ul>
<li>安装ODBC管理程序(例如unixODBC/iODBC等), 这里管理程序选择unixODBC</li>
<li>安装每个数据库对应的ODBC驱动程序, 而Impala的ODBC驱动则参考Cloudera-ODBC-Driver-for-Impala-Install-Guide</li>
</ul>
<h4 id="ClouderaImpalaODBC到Cloudera官网下载"><a href="#ClouderaImpalaODBC到Cloudera官网下载" class="headerlink" title="ClouderaImpalaODBC到Cloudera官网下载:"></a>ClouderaImpalaODBC到Cloudera官网下载:</h4><p><a href="https://downloads.cloudera.com/connectors/impala-2.5.15.1015/Linux/EL6/ClouderaImpalaODBC-2.5.15.1015-1.el6.x86_64.rpm" target="_blank" rel="noopener">https://downloads.cloudera.com/connectors/impala-2.5.15.1015/Linux/EL6/ClouderaImpalaODBC-2.5.15.1015-1.el6.x86_64.rpm</a></p>
<h4 id="若已安装其他版本则先卸载原来安装的"><a href="#若已安装其他版本则先卸载原来安装的" class="headerlink" title="若已安装其他版本则先卸载原来安装的"></a>若已安装其他版本则先卸载原来安装的</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpm -q ClouderaImpalaODBC</span></span><br><span class="line"><span class="comment"># rpm -e ClouderaImpalaODBC-2.5.30.1011-1.x86_64</span></span><br><span class="line"><span class="comment"># yum install -y unixODBC*</span></span><br><span class="line"><span class="comment"># rpm -ivh ClouderaImpalaODBC-2.5.15.1015-1.el6.x86_64.rpm</span></span><br></pre></td></tr></table></figure>
<p>使用odbcinst命令查看unixODBC配置文件路径.<br>不同版本的unixODBC配置文件路径是不同的, 如果是源代码方式安装unixODBC, 也可以通过编译参数–sysconfdir指定.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># odbcinst -j</span></span><br><span class="line">unixODBC 2.2.14</span><br><span class="line">DRIVERS............: /etc/odbcinst.ini</span><br><span class="line">SYSTEM DATA SOURCES: /etc/odbc.ini</span><br><span class="line">FILE DATA SOURCES..: /etc/ODBCDataSources</span><br><span class="line">USER DATA SOURCES..: /root/.odbc.ini</span><br><span class="line">SQLULEN Size.......: 8</span><br><span class="line">SQLLEN Size........: 8</span><br><span class="line">SQLSETPOSIROW Size.: 8</span><br></pre></td></tr></table></figure>
<h4 id="增加环境变量-注意重启后失效-可在-etc-profile里面改使永久生效"><a href="#增加环境变量-注意重启后失效-可在-etc-profile里面改使永久生效" class="headerlink" title="增加环境变量(注意重启后失效, 可在/etc/profile里面改使永久生效)"></a>增加环境变量(注意重启后失效, 可在/etc/profile里面改使永久生效)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># export LD_LIBRARY_PATH=/usr/local/lib:/opt/cloudera/impalaodbc/lib/64</span></span><br></pre></td></tr></table></figure>
<h4 id="动态编译pdo-odbc扩展"><a href="#动态编译pdo-odbc扩展" class="headerlink" title="动态编译pdo-odbc扩展"></a>动态编译pdo-odbc扩展</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># cd /home/xxx/php-7.1.3 # 根据自己的PHP源码路径</span></span><br><span class="line">[root@localhost php-7.1.3]<span class="comment"># cd ext/pdo_odbc/</span></span><br><span class="line">[root@localhost pdo_odbc]<span class="comment"># /application/php/bin/phpize</span></span><br><span class="line">[root@localhost pdo_odbc]<span class="comment"># ./configure --help </span></span><br><span class="line"><span class="comment"># 注意，PHP多版本共存下需要指定PHP</span></span><br><span class="line">[root@localhost pdo_odbc]<span class="comment"># ./configure --with-php-config=/xxx/bin/php-config --with-pdo-odbc=unixODBC,/usr/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># configure: error: Cannot find header file(s) for pdo_odbc</span></span><br><span class="line"><span class="comment"># 完全安装好unixODBC和unixODBC-devel</span></span><br><span class="line"></span><br><span class="line">[root@localhost pdo_odbc]<span class="comment"># make &amp;&amp; make install</span></span><br><span class="line"><span class="comment"># 编辑php.ini加入pdo_odbc.so扩展</span></span><br><span class="line">[root@localhost pdo_odbc]<span class="comment"># vim /xxx/php.ini</span></span><br><span class="line">extension = pdo_odbc.so</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启php查看配置如下:</span></span><br><span class="line">[root@localhost pdo_odbc]<span class="comment"># /etc/init.d/php-fpm restart</span></span><br><span class="line">[root@localhost pdo_odbc]<span class="comment"># php -i |grep odbc</span></span><br><span class="line">PDO drivers =&gt; mysql, sqlite, odbc</span><br><span class="line">LD_LIBRARY_PATH =&gt; /usr/<span class="built_in">local</span>/lib:/opt/cloudera/impalaodbc/lib/64</span><br><span class="line"><span class="variable">$_SERVER</span>[<span class="string">'LD_LIBRARY_PATH'</span>] =&gt; /usr/<span class="built_in">local</span>/lib:/opt/cloudera/impalaodbc/lib/64</span><br></pre></td></tr></table></figure>
<h4 id="动态编译odbc扩展"><a href="#动态编译odbc扩展" class="headerlink" title="动态编译odbc扩展"></a>动态编译odbc扩展</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># cd /home/xxx/php-7.1.3</span></span><br><span class="line">[root@localhost php-7.1.3]<span class="comment"># cd ext/odbc/</span></span><br><span class="line">[root@localhost odbc]<span class="comment"># /application/php/bin/phpize</span></span><br><span class="line">[root@localhost odbc]<span class="comment"># ./configure --help</span></span><br><span class="line">[root@localhost odbc]<span class="comment"># ./configure --with-php-config=/xxx/php7.1.3/bin/php-config --with-unixODBC=/usr/</span></span><br><span class="line">[root@localhost odbc]<span class="comment"># make</span></span><br><span class="line">[root@localhost odbc]<span class="comment"># make install</span></span><br><span class="line">Installing shared extensions:     /xxx/php7.1.3/lib/php/extensions/no-debug-non-zts-20160303/</span><br><span class="line">root@localhost odbc]<span class="comment"># ll /xxx/php7.1.3/lib/php/extensions/no-debug-non-zts-20160303/</span></span><br><span class="line">total 5556</span><br><span class="line">-rwxr-xr-x 1 root root  350680 Mar 24 15:42 memcached.so</span><br><span class="line">-rwxr-xr-x 1 root root  255310 Mar 24 15:00 memcache.so</span><br><span class="line">-rwxr-xr-x 1 root root  173215 Jun 12 09:24 odbc.so</span><br><span class="line">-rwxr-xr-x 1 root root 3020972 Mar 24 14:23 opcache.a</span><br><span class="line">-rwxr-xr-x 1 root root 1750437 Mar 24 14:23 opcache.so</span><br><span class="line">-rwxr-xr-x 1 root root  126680 May 23 14:04 pdo_odbc.so</span><br><span class="line"><span class="comment"># 编辑php.ini加入odbc.so扩展</span></span><br><span class="line">[root@localhost odbc]<span class="comment"># vim /xxx/php/lib/php.ini</span></span><br><span class="line">extension = odbc.so</span><br><span class="line"><span class="comment"># 重启php查看配置信息:</span></span><br><span class="line">[root@localhost odbc]<span class="comment"># /etc/init.d/php-fpm restart</span></span><br><span class="line">[root@localhost odbc]<span class="comment"># php -i |grep odbc</span></span><br><span class="line">odbc</span><br><span class="line">odbc.allow_persistent =&gt; On =&gt; On</span><br><span class="line">odbc.check_persistent =&gt; On =&gt; On</span><br><span class="line">odbc.default_cursortype =&gt; Static cursor =&gt; Static cursor</span><br><span class="line">odbc.default_db =&gt; no value =&gt; no value</span><br><span class="line">odbc.default_pw =&gt; no value =&gt; no value</span><br><span class="line">odbc.default_user =&gt; no value =&gt; no value</span><br><span class="line">odbc.defaultbinmode =&gt; <span class="built_in">return</span> as is =&gt; <span class="built_in">return</span> as is</span><br><span class="line">odbc.defaultlrl =&gt; <span class="built_in">return</span> up to 4096 bytes =&gt; <span class="built_in">return</span> up to 4096 bytes</span><br><span class="line">odbc.max_links =&gt; Unlimited =&gt; Unlimited</span><br><span class="line">odbc.max_persistent =&gt; Unlimited =&gt; Unlimited</span><br><span class="line">PDO drivers =&gt; mysql, sqlite, odbc</span><br><span class="line">LD_LIBRARY_PATH =&gt; /usr/<span class="built_in">local</span>/lib:/opt/cloudera/impalaodbc/lib/64</span><br><span class="line">PWD =&gt; /xxx/php-7.1.3/ext/odbc</span><br><span class="line"><span class="variable">$SERVER</span>[<span class="string">'LD_LIBRARY_PATH'</span>] =&gt; /usr/<span class="built_in">local</span>/lib:/opt/cloudera/impalaodbc/lib/64</span><br><span class="line"><span class="variable">$_SERVER</span>[<span class="string">'PWD'</span>] =&gt; /xxx/php-7.1.3/ext/odbc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意, 如果configure编译的时候出现报错如下:</span></span><br><span class="line">checking <span class="keyword">for</span> Adabas support... cp: cannot <span class="built_in">stat</span> <span class="string">'/usr/local/lib/odbclib.a'</span>: No such file or directory</span><br><span class="line">configure: error: ODBC header file <span class="string">'/usr/local/incl/sqlext.h'</span> not found!</span><br><span class="line"></span><br><span class="line"><span class="comment"># 那么可进行修改configure配置文件:</span></span><br><span class="line">[root@localhost odbc]<span class="comment"># sed -ri 's@^ *test +"\$PHP." *= *"no" *&amp;&amp; *PHP_.=yes *$@#&amp;@g' configure</span></span><br></pre></td></tr></table></figure>
<h4 id="修改-etc-odbc-ini替换为如下-注意！！下文所有的配置文件的每行都一定要保持左对齐！"><a href="#修改-etc-odbc-ini替换为如下-注意！！下文所有的配置文件的每行都一定要保持左对齐！" class="headerlink" title="修改/etc/odbc.ini替换为如下:(注意！！下文所有的配置文件的每行都一定要保持左对齐！)"></a>修改/etc/odbc.ini替换为如下:(注意！！下文所有的配置文件的每行都一定要保持左对齐！)</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">[ODBC]</span><br><span class="line"></span><br><span class="line">Specify any <span class="keyword">global</span> ODBC configuration here such <span class="keyword">as</span> ODBC tracing.</span><br><span class="line">[ODBC Data Sources]</span><br><span class="line">#Cloudera Hive <span class="number">32</span>-bit=Cloudera ODBC Driver <span class="keyword">for</span> Apache Hive <span class="number">32</span>-bit</span><br><span class="line">impala=Cloudera ODBC Driver <span class="keyword">for</span> Impala <span class="number">64</span>-bit</span><br><span class="line">[impala]</span><br><span class="line"></span><br><span class="line">Description: DSN Description.</span><br><span class="line">This key <span class="keyword">is</span> not necessary <span class="built_in">and</span> <span class="keyword">is</span> <span class="keyword">only</span> <span class="keyword">to</span> give <span class="keyword">a</span> description of the data <span class="keyword">source</span>.</span><br><span class="line">Description=Cloudera ODBC Driver <span class="keyword">for</span> Impala (<span class="number">64</span>-bit) DSN</span><br><span class="line"></span><br><span class="line">Driver: The location where the ODBC driver <span class="keyword">is</span> installed <span class="keyword">to</span>.</span><br><span class="line">Driver=/<span class="keyword">opt</span>/cloudera/impalaodbc/lib/<span class="number">64</span>/libclouderaimpalaodbc64.<span class="keyword">so</span></span><br><span class="line"></span><br><span class="line">The DriverUnicodeEncoding setting <span class="keyword">is</span> <span class="keyword">only</span> used <span class="keyword">for</span> SimbaDM</span><br><span class="line">When <span class="keyword">set</span> <span class="keyword">to</span> <span class="number">1</span>, SimbaDM runs in UTF-<span class="number">16</span> <span class="keyword">mode</span>.</span><br><span class="line">When <span class="keyword">set</span> <span class="keyword">to</span> <span class="number">2</span>, SimbaDM runs in UTF-<span class="number">8</span> <span class="keyword">mode</span>.</span><br><span class="line">#DriverUnicodeEncoding=<span class="number">2</span></span><br><span class="line"></span><br><span class="line">Values <span class="keyword">for</span> HOST, PORT, KrbFQDN, <span class="built_in">and</span> KrbServiceName should <span class="keyword">be</span> <span class="keyword">set</span> here.</span><br><span class="line">They can also <span class="keyword">be</span> specified <span class="keyword">on</span> the connection <span class="built_in">string</span>.</span><br><span class="line">HOST=xxx</span><br><span class="line">PORT=xxx</span><br><span class="line">Database=default</span><br><span class="line"></span><br><span class="line">The authentication mechanism.</span><br><span class="line"><span class="number">0</span> - No authentication (NOSASL)</span><br><span class="line"><span class="number">1</span> - Kerberos authentication (SASL)</span><br><span class="line"><span class="number">2</span> - Username authentication (SASL)</span><br><span class="line"><span class="number">3</span> - Username/password authentication (NOSASL <span class="built_in">or</span> SASL depending <span class="keyword">on</span> UseSASL configuration)</span><br><span class="line">AuthMech=<span class="number">0</span></span><br><span class="line"></span><br><span class="line">Set <span class="keyword">to</span> <span class="number">1</span> <span class="keyword">to</span> use SASL <span class="keyword">for</span> authentication.</span><br><span class="line">Set <span class="keyword">to</span> <span class="number">0</span> <span class="keyword">to</span> not use SASL.</span><br><span class="line">When using Kerberos authentication (SASL) <span class="built_in">or</span> Username authentication (SASL) SASL <span class="keyword">is</span> always used</span><br><span class="line"><span class="built_in">and</span> this configuration <span class="keyword">is</span> ignored. SASL <span class="keyword">is</span> always not used <span class="keyword">for</span> No authentication (NOSASL).</span><br><span class="line">UseSASL=<span class="number">0</span></span><br><span class="line"></span><br><span class="line">Kerberos related settings.</span><br><span class="line">KrbFQDN=</span><br><span class="line">KrbRealm=</span><br><span class="line">KrbServiceName=</span><br><span class="line"></span><br><span class="line">Username/password authentication with SASL settings.</span><br><span class="line">UID=hdfs</span><br><span class="line">PWD=</span><br><span class="line"></span><br><span class="line">Set <span class="keyword">to</span> <span class="number">0</span> <span class="keyword">to</span> disable SSL.</span><br><span class="line">Set <span class="keyword">to</span> <span class="number">1</span> <span class="keyword">to</span> enable SSL.</span><br><span class="line">SSL=<span class="number">0</span></span><br><span class="line">CAIssuedCertNamesMismatch=<span class="number">1</span></span><br><span class="line">TrustedCerts=/<span class="keyword">opt</span>/cloudera/impalaodbc/lib/<span class="number">64</span>/cacerts.pem</span><br><span class="line"></span><br><span class="line">General settings</span><br><span class="line">TSaslTransportBufSize=<span class="number">1000</span></span><br><span class="line">RowsFetchedPerBlock=<span class="number">10000</span></span><br><span class="line">SocketTimeout=<span class="number">0</span></span><br><span class="line">StringColumnLength=<span class="number">32767</span></span><br><span class="line">UseNativeQuery=<span class="number">0</span></span><br></pre></td></tr></table></figure>
<h4 id="修改-etc-odbcins-ini替换为如下"><a href="#修改-etc-odbcins-ini替换为如下" class="headerlink" title="修改/etc/odbcins.ini替换为如下:"></a>修改/etc/odbcins.ini替换为如下:</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[ODBC Drivers]</span><br><span class="line">Cloudera ODBC Driver <span class="keyword">for</span> Impala <span class="number">64</span>-bit=Installed</span><br><span class="line">#[Cloudera ODBC Driver <span class="keyword">for</span> Apache Hive <span class="number">32</span>-bit]</span><br><span class="line">#Description=Cloudera ODBC Driver <span class="keyword">for</span> Apache Hive (<span class="number">32</span>-bit)</span><br><span class="line">#Driver=/<span class="keyword">opt</span>/cloudera/hiveodbc/lib/<span class="number">32</span>/libclouderahiveodbc32.<span class="keyword">so</span></span><br><span class="line"></span><br><span class="line">The option below <span class="keyword">is</span> <span class="keyword">for</span> using unixODBC when compiled with -DSQL_WCHART_CONVERT.</span><br><span class="line">Execute <span class="string">'odbc_config --cflags'</span> <span class="keyword">to</span> determine <span class="keyword">if</span> you need <span class="keyword">to</span> uncomment it.</span><br><span class="line">IconvEncoding=UCS-<span class="number">4</span>LE</span><br><span class="line">[Cloudera ODBC Driver <span class="keyword">for</span> Impala <span class="number">64</span>-bit]</span><br><span class="line">Description=Cloudera ODBC Driver <span class="keyword">for</span> Impala (<span class="number">64</span>-bit)</span><br><span class="line">Driver=/<span class="keyword">opt</span>/cloudera/impalaodbc/lib/<span class="number">64</span>/libclouderaimpalaodbc64.<span class="keyword">so</span></span><br><span class="line"></span><br><span class="line">The option below <span class="keyword">is</span> <span class="keyword">for</span> using unixODBC when compiled with -DSQL_WCHART_CONVERT.</span><br><span class="line">Execute <span class="string">'odbc_config --cflags'</span> <span class="keyword">to</span> determine <span class="keyword">if</span> you need <span class="keyword">to</span> uncomment it.</span><br><span class="line">IconvEncoding=UCS-<span class="number">4</span>LE</span><br></pre></td></tr></table></figure>
<h4 id="修改-etc-cloudera-impalaodbc-ini"><a href="#修改-etc-cloudera-impalaodbc-ini" class="headerlink" title="修改/etc/cloudera.impalaodbc.ini"></a>修改/etc/cloudera.impalaodbc.ini</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[Driver]</span><br><span class="line"></span><br><span class="line">- Note that this default DriverManagerEncoding of UTF-<span class="number">32</span> <span class="keyword">is</span> <span class="keyword">for</span> iODBC.</span><br><span class="line">- unixODBC uses UTF-<span class="number">16</span> by default.</span><br><span class="line">- If unixODBC was compiled with -DSQL_WCHART_CONVERT, then UTF-<span class="number">32</span> <span class="keyword">is</span> the correct value.</span><br><span class="line">##   Execute <span class="string">'odbc_config --cflags'</span> <span class="keyword">to</span> determine <span class="keyword">if</span> you need UTF-<span class="number">32</span> <span class="built_in">or</span> UTF-<span class="number">16</span> <span class="keyword">on</span> unixODBC</span><br><span class="line"></span><br><span class="line">- SimbaDM can <span class="keyword">be</span> used with UTF-<span class="number">8</span> <span class="built_in">or</span> UTF-<span class="number">16</span>.</span><br><span class="line">##   The DriverUnicodeEncoding setting will cause SimbaDM <span class="keyword">to</span> run in UTF-<span class="number">8</span> when <span class="keyword">set</span> <span class="keyword">to</span> <span class="number">2</span> <span class="built_in">or</span> UTF-<span class="number">16</span> when <span class="keyword">set</span> <span class="keyword">to</span> <span class="number">1</span>.</span><br><span class="line">DriverManagerEncoding=UTF-<span class="number">32</span></span><br><span class="line">ErrorMessagesPath=/<span class="keyword">opt</span>/cloudera/impalaodbc/ErrorMessages</span><br><span class="line">LogLevel=<span class="number">0</span></span><br><span class="line">LogPath=</span><br><span class="line"></span><br><span class="line">- Uncomment the ODBCInstLib corresponding <span class="keyword">to</span> the Driver Manager being used.</span><br><span class="line">- Note that the path <span class="keyword">to</span> your ODBC Driver Manager must <span class="keyword">be</span> specified in LD_LIBRARY_PATH (LIBPATH <span class="keyword">for</span> AIX).</span><br><span class="line">- Note that AIX <span class="built_in">has</span> <span class="keyword">a</span> different format <span class="keyword">for</span> specifying its shared libraries.</span><br><span class="line">Generic ODBCInstLib</span><br><span class="line">#   iODBC</span><br><span class="line">#ODBCInstLib=libiodbcinst.<span class="keyword">so</span></span><br><span class="line">#   SimbaDM / unixODBC</span><br><span class="line">ODBCInstLib=libodbcinst.<span class="keyword">so</span></span><br><span class="line"></span><br><span class="line">AIX specific ODBCInstLib</span><br><span class="line">#   iODBC</span><br><span class="line">#ODBCInstLib=libiodbcinst.<span class="keyword">a</span>(libiodbcinst.<span class="keyword">so</span>.<span class="number">2</span>)</span><br><span class="line">#   SimbaDM</span><br><span class="line">#ODBCInstLib=libodbcinst.<span class="keyword">a</span>(odbcinst.<span class="keyword">so</span>)</span><br><span class="line">#   unixODBC</span><br><span class="line">#ODBCInstLib=libodbcinst.<span class="keyword">a</span>(libodbcinst.<span class="keyword">so</span>.<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h4 id="测试连接impala"><a href="#测试连接impala" class="headerlink" title="测试连接impala"></a>测试连接impala</h4><p>因为在/etc/odbc.ini我们设定的DSN名称为impala, 所以执行如下语句:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># isql -v 'impala'</span></span><br><span class="line">        +---------------------------------------+</span><br><span class="line">        | Connected!                            |</span><br><span class="line">        |                                       |</span><br><span class="line">        | sql-statement                         |</span><br><span class="line">        | <span class="built_in">help</span> [tablename]                      |</span><br><span class="line">        | quit                                  |</span><br><span class="line">        |                                       |</span><br><span class="line">        +---------------------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="PHP通过ODBC连接Impala-方法2"><a href="#PHP通过ODBC连接Impala-方法2" class="headerlink" title="PHP通过ODBC连接Impala(方法2)"></a>PHP通过ODBC连接Impala(方法2)</h3><h4 id="安装ODBC相关软件包以及ImpalaODBC驱动-1"><a href="#安装ODBC相关软件包以及ImpalaODBC驱动-1" class="headerlink" title="安装ODBC相关软件包以及ImpalaODBC驱动"></a>安装ODBC相关软件包以及ImpalaODBC驱动</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum install -y unixODBC*</span></span><br><span class="line"><span class="comment"># rpm -ivh ClouderaImpalaODBC-2.5.15.1015-1.el6.x86_64.rpm</span></span><br></pre></td></tr></table></figure>
<h4 id="新建存放配置的目录"><a href="#新建存放配置的目录" class="headerlink" title="新建存放配置的目录"></a>新建存放配置的目录</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># mkdir /home/xxx/config_odbc</span></span><br><span class="line">[root@localhost ~]<span class="comment"># cd /home/xxx/config_odbc</span></span><br><span class="line">[root@localhost config_odbc]<span class="comment"># mkdir odbc</span></span><br></pre></td></tr></table></figure>
<h4 id="创建环境变量文件common-env"><a href="#创建环境变量文件common-env" class="headerlink" title="创建环境变量文件common.env"></a>创建环境变量文件common.env</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost config_odbc]# <span class="keyword">vim</span> common.env</span><br><span class="line"></span><br><span class="line">CONFIG_DIR=$(readlink -<span class="keyword">f</span> $(dirname $&#123;BASH_SOURCE[<span class="number">0</span>]&#125;))</span><br><span class="line">ODBC_CONFIG_DIR=$&#123;CONFIG_DIR&#125;/odbc</span><br><span class="line">export ODBCINI=$&#123;ODBC_CONFIG_DIR&#125;/odbc.ini</span><br><span class="line">export ODBCSYSINI=$&#123;ODBC_CONFIG_DIR&#125;</span><br><span class="line">export CLOUDERAIMPALAINI=$&#123;ODBC_CONFIG_DIR&#125;/cloudera.impalaodbc.ini</span><br><span class="line">export CLOUDERAHIVEINI=$&#123;ODBC_CONFIG_DIR&#125;/cloudera.hiveodbc.ini</span><br><span class="line">export LD_LIBRARY_PATH=/usr/local/li<span class="variable">b:</span>/<span class="keyword">opt</span>/cloudera/impalaodbc/lib/<span class="number">64</span></span><br></pre></td></tr></table></figure>
<h4 id="创建配置odbc-odbc-ini"><a href="#创建配置odbc-odbc-ini" class="headerlink" title="创建配置odbc/odbc.ini"></a>创建配置odbc/odbc.ini</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost config_odbc]# <span class="keyword">vim</span> odbc/odbc.ini    【注意里面包含了ODBC连接hive和impala的配置】</span><br><span class="line"></span><br><span class="line">[ODBC]</span><br><span class="line"># Specify any <span class="keyword">global</span> ODBC configuration here such <span class="keyword">as</span> ODBC tracing.</span><br><span class="line">[ODBC Data Sources]</span><br><span class="line">#Cloudera Hive <span class="number">32</span>-bit=Cloudera ODBC Driver <span class="keyword">for</span> Apache Hive <span class="number">32</span>-bit</span><br><span class="line">hive=Cloudera ODBC Driver <span class="keyword">for</span> Apache Hive <span class="number">64</span>-bit</span><br><span class="line">impala=Cloudera ODBC Driver <span class="keyword">for</span> Impala <span class="number">64</span>-bit</span><br><span class="line">[hive]</span><br><span class="line"># Description: DSN Description.</span><br><span class="line"># This key <span class="keyword">is</span> not necessary <span class="built_in">and</span> <span class="keyword">is</span> <span class="keyword">only</span> <span class="keyword">to</span> give <span class="keyword">a</span> description of the data <span class="keyword">source</span>.</span><br><span class="line">Description=Cloudera ODBC Driver <span class="keyword">for</span> Apache Hive (<span class="number">64</span>-bit) DSN</span><br><span class="line"># Driver: The location where the ODBC driver <span class="keyword">is</span> installed <span class="keyword">to</span>.</span><br><span class="line">Driver=/<span class="keyword">opt</span>/cloudera/hiveodbc/lib/<span class="number">64</span>/libclouderahiveodbc64.<span class="keyword">so</span></span><br><span class="line"># When using No Service Discovery, specify the IP address <span class="built_in">or</span> host name of the Hive server.</span><br><span class="line"># When using ZooKeeper <span class="keyword">as</span> the Service Discovery Mode, specify <span class="keyword">a</span> comma-separated <span class="keyword">list</span> of ZooKeeper</span><br><span class="line"># servers in the following forma<span class="variable">t:</span></span><br><span class="line">#       &lt;zk_host1:zk_port1&gt;,&lt;zk_host2:zk_port2&gt;,...</span><br><span class="line">HOST=<span class="number">192.168</span>.<span class="number">11.9</span></span><br><span class="line"># The TCP port Hive server <span class="keyword">is</span> listening. This <span class="keyword">is</span> not required when using ZooKeeper <span class="keyword">as</span> the service</span><br><span class="line"># discovery <span class="keyword">mode</span> <span class="keyword">as</span> the port <span class="keyword">is</span> specified in the HOST connection attribute.</span><br><span class="line">PORT=<span class="number">10000</span></span><br><span class="line"># The name of the database schema <span class="keyword">to</span> use when <span class="keyword">a</span> schema <span class="keyword">is</span> not explicitly specified in <span class="keyword">a</span> query.</span><br><span class="line">Schema=default</span><br><span class="line"># Set <span class="keyword">to</span> <span class="number">0</span> <span class="keyword">to</span> when connecting directory <span class="keyword">to</span> Hive Server <span class="number">2</span> (No Service Discovery).</span><br><span class="line"># Set <span class="keyword">to</span> <span class="number">1</span> <span class="keyword">to</span> <span class="keyword">do</span> Hive Server <span class="number">2</span> service discovery using ZooKeeper.</span><br><span class="line"># Note service discovery <span class="keyword">is</span> not support when using Hive Server <span class="number">1</span>.</span><br><span class="line">ServiceDiscoveryMode=<span class="number">0</span></span><br><span class="line"># The namespace <span class="keyword">on</span> ZooKeeper under which Hive Server <span class="number">2</span> znodes are added. Required <span class="keyword">only</span> when doing</span><br><span class="line"># HS2 service discovery with ZooKeeper (ServiceDiscoveryMode=<span class="number">1</span>).</span><br><span class="line">ZKNamespace=</span><br><span class="line"># Set <span class="keyword">to</span> <span class="number">1</span> <span class="keyword">if</span> you are connecting <span class="keyword">to</span> Hive Server <span class="number">1</span>. Set <span class="keyword">to</span> <span class="number">2</span> <span class="keyword">if</span> you are connecting <span class="keyword">to</span> Hive Server <span class="number">2</span>.</span><br><span class="line">HiveServerType=<span class="number">2</span></span><br><span class="line"># The authentication mechanism <span class="keyword">to</span> use <span class="keyword">for</span> the connection.</span><br><span class="line">#   Set <span class="keyword">to</span> <span class="number">0</span> <span class="keyword">for</span> No Authentication</span><br><span class="line">#   Set <span class="keyword">to</span> <span class="number">1</span> <span class="keyword">for</span> Kerberos</span><br><span class="line">#   Set <span class="keyword">to</span> <span class="number">2</span> <span class="keyword">for</span> User Name</span><br><span class="line">#   Set <span class="keyword">to</span> <span class="number">3</span> <span class="keyword">for</span> User Name <span class="built_in">and</span> Password</span><br><span class="line"># Note <span class="keyword">only</span> No Authentication <span class="keyword">is</span> supported when connecting <span class="keyword">to</span> Hive Server <span class="number">1</span>.</span><br><span class="line">AuthMech=<span class="number">2</span></span><br><span class="line"># The Thrift transport <span class="keyword">to</span> use <span class="keyword">for</span> the connection.</span><br><span class="line">#    Set <span class="keyword">to</span> <span class="number">0</span> <span class="keyword">for</span> Binary</span><br><span class="line">#    Set <span class="keyword">to</span> <span class="number">1</span> <span class="keyword">for</span> SASL</span><br><span class="line">#    Set <span class="keyword">to</span> <span class="number">2</span> <span class="keyword">for</span> HTTP</span><br><span class="line"># Note <span class="keyword">for</span> Hive Server <span class="number">1</span> <span class="keyword">only</span> Binary can <span class="keyword">be</span> used.</span><br><span class="line">ThriftTransport=<span class="number">1</span></span><br><span class="line"># When this option <span class="keyword">is</span> enabled (<span class="number">1</span>), the driver does not transform the queries emitted by <span class="keyword">an</span></span><br><span class="line"># application, <span class="keyword">so</span> the native query <span class="keyword">is</span> used.</span><br><span class="line"># When this option <span class="keyword">is</span> disabled (<span class="number">0</span>), the driver transforms the queries emitted by <span class="keyword">an</span> application <span class="built_in">and</span></span><br><span class="line"># converts them into <span class="keyword">an</span> equivalent from in HiveQL.</span><br><span class="line">UseNativeQuery=<span class="number">0</span></span><br><span class="line"># Set the UID with the user name <span class="keyword">to</span> use <span class="keyword">to</span> access Hive when using AuthMech <span class="number">2</span> <span class="keyword">to</span> <span class="number">8</span>.</span><br><span class="line">UID=hdfs</span><br><span class="line"># The following <span class="keyword">is</span> settings used when using Kerberos authentication (AuthMech <span class="number">1</span> <span class="built_in">and</span> <span class="number">10</span>)</span><br><span class="line"># The fully qualified host name part of the of the Hive Server <span class="number">2</span> Kerberos service principal.</span><br><span class="line"># For example <span class="keyword">if</span> the service principal name of you Hive Server <span class="number">2</span> i<span class="variable">s:</span></span><br><span class="line">#   hive/myhs2.mydomain.com@EXAMPLE.COM</span><br><span class="line"># Then <span class="keyword">set</span> KrbHostFQDN <span class="keyword">to</span> myhs2.mydomain.<span class="keyword">com</span></span><br><span class="line">KrbHostFQDN=_HOST</span><br><span class="line"># The service name part of the of the Hive Server <span class="number">2</span> Kerberos service principal.</span><br><span class="line"># For example <span class="keyword">if</span> the service principal name of you Hive Server <span class="number">2</span> i<span class="variable">s:</span></span><br><span class="line">#   hive/myhs2.mydomain.com@EXAMPLE.COM</span><br><span class="line"># Then <span class="keyword">set</span> KrbServiceName <span class="keyword">to</span> hive</span><br><span class="line">KrbServiceName=hive</span><br><span class="line"># The realm part of the of the Hive Server <span class="number">2</span> Kerberos service principal.</span><br><span class="line"># For example <span class="keyword">if</span> the service principal name of you Hive Server <span class="number">2</span> i<span class="variable">s:</span></span><br><span class="line">#   hive/myhs2.mydomain.com@EXAMPLE.COM</span><br><span class="line"># Then <span class="keyword">set</span> KrbRealm <span class="keyword">to</span> EXAMPLE.COM</span><br><span class="line">KrbRealm=</span><br><span class="line"># Set <span class="keyword">to</span> <span class="number">1</span> <span class="keyword">to</span> enable SSL. Set <span class="keyword">to</span> <span class="number">0</span> <span class="keyword">to</span> disable.</span><br><span class="line">SSL=<span class="number">0</span></span><br><span class="line"># Set <span class="keyword">to</span> <span class="number">1</span> <span class="keyword">to</span> enable two-way SSL. Set <span class="keyword">to</span> <span class="number">0</span> <span class="keyword">to</span> disable. You must enable SSL in order <span class="keyword">to</span></span><br><span class="line"># use two-way SSL.</span><br><span class="line">TwoWaySSL=<span class="number">0</span></span><br><span class="line"># The <span class="keyword">file</span> containing the client certificate in PEM format. This <span class="keyword">is</span> required when using two-way SSL.</span><br><span class="line">ClientCert=</span><br><span class="line"># The client private key. This <span class="keyword">is</span> used <span class="keyword">for</span> two-way SSL authentication.</span><br><span class="line">ClientPrivateKey=</span><br><span class="line"># The password <span class="keyword">for</span> the client private key. Password <span class="keyword">is</span> <span class="keyword">only</span> required <span class="keyword">for</span> password protected</span><br><span class="line"># client private key.</span><br><span class="line">ClientPrivateKeyPassword=</span><br><span class="line">[impala]</span><br><span class="line"># Description: DSN Description.</span><br><span class="line"># This key <span class="keyword">is</span> not necessary <span class="built_in">and</span> <span class="keyword">is</span> <span class="keyword">only</span> <span class="keyword">to</span> give <span class="keyword">a</span> description of the data <span class="keyword">source</span>.</span><br><span class="line">Description=Cloudera ODBC Driver <span class="keyword">for</span> Impala (<span class="number">64</span>-bit) DSN</span><br><span class="line"># Driver: The location where the ODBC driver <span class="keyword">is</span> installed <span class="keyword">to</span>.</span><br><span class="line">Driver=/<span class="keyword">opt</span>/cloudera/impalaodbc/lib/<span class="number">64</span>/libclouderaimpalaodbc64.<span class="keyword">so</span></span><br><span class="line"># The DriverUnicodeEncoding setting <span class="keyword">is</span> <span class="keyword">only</span> used <span class="keyword">for</span> SimbaDM</span><br><span class="line"># When <span class="keyword">set</span> <span class="keyword">to</span> <span class="number">1</span>, SimbaDM runs in UTF-<span class="number">16</span> <span class="keyword">mode</span>.</span><br><span class="line"># When <span class="keyword">set</span> <span class="keyword">to</span> <span class="number">2</span>, SimbaDM runs in UTF-<span class="number">8</span> <span class="keyword">mode</span>.</span><br><span class="line">#DriverUnicodeEncoding=<span class="number">2</span></span><br><span class="line"># Values <span class="keyword">for</span> HOST, PORT, KrbFQDN, <span class="built_in">and</span> KrbServiceName should <span class="keyword">be</span> <span class="keyword">set</span> here.</span><br><span class="line"># They can also <span class="keyword">be</span> specified <span class="keyword">on</span> the connection <span class="built_in">string</span>.</span><br><span class="line">HOST=<span class="number">192.168</span>.<span class="number">11.10</span></span><br><span class="line">PORT=<span class="number">21050</span></span><br><span class="line">Database=default</span><br><span class="line"># The authentication mechanism.</span><br><span class="line"># <span class="number">0</span> - No authentication (NOSASL)</span><br><span class="line"># <span class="number">1</span> - Kerberos authentication (SASL)</span><br><span class="line"># <span class="number">2</span> - Username authentication (SASL)</span><br><span class="line"># <span class="number">3</span> - Username/password authentication (NOSASL <span class="built_in">or</span> SASL depending <span class="keyword">on</span> UseSASL configuration)</span><br><span class="line">AuthMech=<span class="number">3</span></span><br><span class="line"># Set <span class="keyword">to</span> <span class="number">1</span> <span class="keyword">to</span> use SASL <span class="keyword">for</span> authentication.</span><br><span class="line"># Set <span class="keyword">to</span> <span class="number">0</span> <span class="keyword">to</span> not use SASL.</span><br><span class="line"># When using Kerberos authentication (SASL) <span class="built_in">or</span> Username authentication (SASL) SASL <span class="keyword">is</span> always used</span><br><span class="line"># <span class="built_in">and</span> this configuration <span class="keyword">is</span> ignored. SASL <span class="keyword">is</span> always not used <span class="keyword">for</span> No authentication (NOSASL).</span><br><span class="line">UseSASL=<span class="number">0</span></span><br><span class="line"># Kerberos related settings.</span><br><span class="line">KrbFQDN=</span><br><span class="line">KrbRealm=</span><br><span class="line">KrbServiceName=</span><br><span class="line"># Username/password authentication with SASL settings.</span><br><span class="line">UID=hdfs</span><br><span class="line">PWD=</span><br><span class="line"># Set <span class="keyword">to</span> <span class="number">0</span> <span class="keyword">to</span> disable SSL.</span><br><span class="line"># Set <span class="keyword">to</span> <span class="number">1</span> <span class="keyword">to</span> enable SSL.</span><br><span class="line">SSL=<span class="number">0</span></span><br><span class="line">CAIssuedCertNamesMismatch=<span class="number">1</span></span><br><span class="line">TrustedCerts=/<span class="keyword">opt</span>/cloudera/impalaodbc/lib/<span class="number">64</span>/cacerts.pem</span><br><span class="line"># General settings</span><br><span class="line">TSaslTransportBufSize=<span class="number">1000</span></span><br><span class="line">RowsFetchedPerBlock=<span class="number">10000</span></span><br><span class="line">SocketTimeout=<span class="number">0</span></span><br><span class="line">StringColumnLength=<span class="number">32767</span></span><br><span class="line">UseNativeQuery=<span class="number">0</span></span><br></pre></td></tr></table></figure>
<h4 id="创建配置odbc-odbcinst-ini"><a href="#创建配置odbc-odbcinst-ini" class="headerlink" title="创建配置odbc/odbcinst.ini"></a>创建配置odbc/odbcinst.ini</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost config_odbc]# <span class="keyword">vim</span> odbc/odbcinst.ini    【注意里面包含了ODBC连接hive和impala的配置】</span><br><span class="line"></span><br><span class="line">[ODBC Drivers]</span><br><span class="line">Cloudera ODBC Driver <span class="keyword">for</span> Apache Hive <span class="number">64</span>-bit=Installed</span><br><span class="line">Cloudera ODBC Driver <span class="keyword">for</span> Impala <span class="number">64</span>-bit=Installed</span><br><span class="line">#[Cloudera ODBC Driver <span class="keyword">for</span> Apache Hive <span class="number">32</span>-bit]</span><br><span class="line">#Description=Cloudera ODBC Driver <span class="keyword">for</span> Apache Hive (<span class="number">32</span>-bit)</span><br><span class="line">#Driver=/<span class="keyword">opt</span>/cloudera/hiveodbc/lib/<span class="number">32</span>/libclouderahiveodbc32.<span class="keyword">so</span></span><br><span class="line">[Cloudera ODBC Driver <span class="keyword">for</span> Apache Hive <span class="number">64</span>-bit]</span><br><span class="line">Description=Cloudera ODBC Driver <span class="keyword">for</span> Apache Hive (<span class="number">64</span>-bit)</span><br><span class="line">Driver=/<span class="keyword">opt</span>/cloudera/hiveodbc/lib/<span class="number">64</span>/libclouderahiveodbc64.<span class="keyword">so</span></span><br><span class="line">## The option below <span class="keyword">is</span> <span class="keyword">for</span> using unixODBC when compiled with -DSQL_WCHART_CONVERT.</span><br><span class="line">## Execute <span class="string">'odbc_config --cflags'</span> <span class="keyword">to</span> determine <span class="keyword">if</span> you need <span class="keyword">to</span> uncomment it.</span><br><span class="line"># IconvEncoding=UCS-<span class="number">4</span>LE</span><br><span class="line">[Cloudera ODBC Driver <span class="keyword">for</span> Impala <span class="number">64</span>-bit]</span><br><span class="line">Description=Cloudera ODBC Driver <span class="keyword">for</span> Impala (<span class="number">64</span>-bit)</span><br><span class="line">Driver=/<span class="keyword">opt</span>/cloudera/impalaodbc/lib/<span class="number">64</span>/libclouderaimpalaodbc64.<span class="keyword">so</span></span><br><span class="line">## The option below <span class="keyword">is</span> <span class="keyword">for</span> using unixODBC when compiled with -DSQL_WCHART_CONVERT.</span><br><span class="line">## Execute <span class="string">'odbc_config --cflags'</span> <span class="keyword">to</span> determine <span class="keyword">if</span> you need <span class="keyword">to</span> uncomment it.</span><br><span class="line"># IconvEncoding=UCS-<span class="number">4</span>LE</span><br></pre></td></tr></table></figure>
<h4 id="创建配置odbc-cloudera-impalaodbc-ini"><a href="#创建配置odbc-cloudera-impalaodbc-ini" class="headerlink" title="创建配置odbc/cloudera.impalaodbc.ini"></a>创建配置odbc/cloudera.impalaodbc.ini</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost config_odbc]# <span class="keyword">vim</span> odbc/cloudera.impalaodbc.ini    【注意里面包含了ODBC连接hive和impala的配置】</span><br><span class="line"></span><br><span class="line">[Driver]</span><br><span class="line">## - Note that this default DriverManagerEncoding of UTF-<span class="number">32</span> <span class="keyword">is</span> <span class="keyword">for</span> iODBC.</span><br><span class="line">## - unixODBC uses UTF-<span class="number">16</span> by default.</span><br><span class="line">## - If unixODBC was compiled with -DSQL_WCHART_CONVERT, then UTF-<span class="number">32</span> <span class="keyword">is</span> the correct value.</span><br><span class="line">##   Execute <span class="string">'odbc_config --cflags'</span> <span class="keyword">to</span> determine <span class="keyword">if</span> you need UTF-<span class="number">32</span> <span class="built_in">or</span> UTF-<span class="number">16</span> <span class="keyword">on</span> unixODBC</span><br><span class="line">## - SimbaDM can <span class="keyword">be</span> used with UTF-<span class="number">8</span> <span class="built_in">or</span> UTF-<span class="number">16</span>.</span><br><span class="line">##   The DriverUnicodeEncoding setting will cause SimbaDM <span class="keyword">to</span> run in UTF-<span class="number">8</span> when <span class="keyword">set</span> <span class="keyword">to</span> <span class="number">2</span> <span class="built_in">or</span> UTF-<span class="number">16</span> when <span class="keyword">set</span> <span class="keyword">to</span> <span class="number">1</span>.</span><br><span class="line">DriverManagerEncoding=UTF-<span class="number">32</span></span><br><span class="line">ErrorMessagesPath=/<span class="keyword">opt</span>/cloudera/impalaodbc/ErrorMessages</span><br><span class="line">LogLevel=<span class="number">0</span></span><br><span class="line">LogPath=</span><br><span class="line">## - Uncomment the ODBCInstLib corresponding <span class="keyword">to</span> the Driver Manager being used.</span><br><span class="line">## - Note that the path <span class="keyword">to</span> your ODBC Driver Manager must <span class="keyword">be</span> specified in LD_LIBRARY_PATH (LIBPATH <span class="keyword">for</span> AIX).</span><br><span class="line">## - Note that AIX <span class="built_in">has</span> <span class="keyword">a</span> different format <span class="keyword">for</span> specifying its shared libraries.</span><br><span class="line"># Generic ODBCInstLib</span><br><span class="line">#   iODBC</span><br><span class="line">#ODBCInstLib=libiodbcinst.<span class="keyword">so</span></span><br><span class="line">#   SimbaDM / unixODBC</span><br><span class="line">ODBCInstLib=libodbcinst.<span class="keyword">so</span></span><br><span class="line"># AIX specific ODBCInstLib</span><br><span class="line">#   iODBC</span><br><span class="line">#ODBCInstLib=libiodbcinst.<span class="keyword">a</span>(libiodbcinst.<span class="keyword">so</span>.<span class="number">2</span>)</span><br><span class="line">#   SimbaDM</span><br><span class="line">#ODBCInstLib=libodbcinst.<span class="keyword">a</span>(odbcinst.<span class="keyword">so</span>)</span><br><span class="line">#   unixODBC</span><br><span class="line">#ODBCInstLib=libodbcinst.<span class="keyword">a</span>(libodbcinst.<span class="keyword">so</span>.<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h4 id="创建配置cloudera-hiveodbc-ini"><a href="#创建配置cloudera-hiveodbc-ini" class="headerlink" title="创建配置cloudera.hiveodbc.ini"></a>创建配置cloudera.hiveodbc.ini</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost config_odbc]# <span class="keyword">vim</span> odbc/cloudera.hiveodbc.ini    【注意里面包含了ODBC连接hive和impala的配置】</span><br><span class="line"></span><br><span class="line">[Driver]</span><br><span class="line">ErrorMessagesPath=/<span class="keyword">opt</span>/cloudera/hiveodbc/ErrorMessages/</span><br><span class="line">LogLevel=<span class="number">0</span></span><br><span class="line">LogPath=</span><br><span class="line">SwapFilePath=/tmp</span><br></pre></td></tr></table></figure>
<h4 id="进行测试"><a href="#进行测试" class="headerlink" title="进行测试"></a>进行测试</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost config_odbc]<span class="comment"># source common.env</span></span><br><span class="line">        [root@localhost config_odbc]<span class="comment"># isql -v 'impala'</span></span><br><span class="line">        +---------------------------------------+</span><br><span class="line">        | Connected!                            |</span><br><span class="line">        |                                       |</span><br><span class="line">        | sql-statement                         |</span><br><span class="line">        | <span class="built_in">help</span> [tablename]                      |</span><br><span class="line">        | quit                                  |</span><br><span class="line">        |                                       |</span><br><span class="line">        +---------------------------------------+</span><br></pre></td></tr></table></figure>
<p>注意前提是, 连接的IP的端口已经开启了此机器的访问权限, 否则会出现如下错误:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost config_odbc]<span class="comment"># isql -v 'impala'</span></span><br><span class="line">        [S1000][unixODBC][Cloudera][ImpalaODBC] (100) Error from the Impala Thrift API: connect() failed: Connection timed out</span><br><span class="line">        [ISQL]ERROR: Could not SQLConnect</span><br></pre></td></tr></table></figure>
<h4 id="运行php进行测试"><a href="#运行php进行测试" class="headerlink" title="运行php进行测试"></a>运行php进行测试</h4><p>1)如果是安装odbc扩展的, 如下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=<span class="variable">$php_root</span> --with-config-file-path=/etc --with-mysql=<span class="variable">$mysql_root</span> --with-pdo-mysql=<span class="variable">$mysql_root</span>/bin/mysql_config --with-mysqli=<span class="variable">$mysql_root</span>/bin/mysql_config --with-iconv-dir=/usr/<span class="built_in">local</span> --with-freetype-dir --with-jpeg-dir --with-png-dir --<span class="built_in">enable</span>-gd-native-ttf --<span class="built_in">enable</span>-zip --with-zlib --with-gd --<span class="built_in">disable</span>-rpath --<span class="built_in">enable</span>-bcmath --<span class="built_in">enable</span>-shmop --<span class="built_in">enable</span>-sysvsem --with-curl --with-curlwrappers --<span class="built_in">enable</span>-mbstring --with-mcrypt --<span class="built_in">disable</span>-ipv6 --<span class="built_in">enable</span>-static --<span class="built_in">enable</span>-maintainer-zts --<span class="built_in">enable</span>-sockets --<span class="built_in">enable</span>-soap --with-openssl --without-pdo-sqlite --<span class="built_in">enable</span>-fpm --with-unixODBC=/usr/</span><br></pre></td></tr></table></figure>
<p>那么, 就用面向过程的写法:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># vim test-php-odbc-impala.php</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$conn = odbc_connect(<span class="string">"impala"</span>, <span class="string">""</span>, <span class="string">""</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"开始时间:"</span> . time() . <span class="string">"\r\n"</span>;</span><br><span class="line">$sql = <span class="string">"select * from db_mcfx_log.t_log_sdk_log_pay"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"准备执行sql语句: $sql\r\n"</span>;</span><br><span class="line">$rs = odbc_exec($conn, $sql);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"语句执行完成, 准备开始获取结果集\r\n"</span>;</span><br><span class="line">$result = [];</span><br><span class="line"><span class="keyword">while</span> ($row=odbc_fetch_array($rs)) &#123;</span><br><span class="line">    $result[] = $row;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"结果获取完毕\r\n"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"总记录数量: "</span> . sizeof($result) . <span class="string">"\r\n"</span>;</span><br><span class="line">odbc_close($conn);</span><br><span class="line">var_dump($conn);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"结束时间: "</span> . time() . <span class="string">"\r\n"</span>;</span><br></pre></td></tr></table></figure>
<p>2)如果是安装pdo_odbc扩展的, 那么就用面向过程的方法如下测试:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$dbh= <span class="keyword">new</span> PDO(<span class="string">'odbc:impala'</span>, <span class="string">''</span>, <span class="string">''</span>);</span><br><span class="line">$sql = <span class="string">"select count(*) from db_mcfx_log.t_log_sdk_log_pay"</span>;</span><br><span class="line">$stmt = $dbh-&gt;prepare(<span class="string">"$sql"</span>);</span><br><span class="line">$stmt-&gt;execute();</span><br><span class="line"><span class="keyword">while</span> ($row = $stmt-&gt;fetch()) &#123;</span><br><span class="line">    print_r($row);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">unset</span>($dbh); <span class="keyword">unset</span>($stmt);</span><br></pre></td></tr></table></figure>
<p>3)注意:</p>
<p>如果PHP开启了开机自启动, 那么可能会出现连接odbc报错说库文件找不到.<br>这时候, 可以重启PHP那么就可以解决了, 原因暂时未明.</p>
<h3 id="php常用ODBC函数集"><a href="#php常用ODBC函数集" class="headerlink" title="php常用ODBC函数集"></a>php常用ODBC函数集</h3><ol>
<li>ODBC连接类函数<br> odbc_connect函数: 打开一个ODBC连接<br> odbc_close函数: 关闭一个已经打开的ODBC连接<br> odbc_close_all函数: 关闭所有已经打开的ODBC连接<br> odbc_pconnect函数: 打开一个持续有效的ODBC连接</li>
<li>ODBC操作类函数<br> odbc_commit函数: 更新所有处于未决状态的操作<br> odbc_do函数: 在打开的ODBC连接上执行SQL语句<br> odbc_exec函数: 执行SQL语句<br> odbc_execute函数: 执行一个预置的SQL语句<br> odbc_free_result函数: 释放传回资料所占用的内存<br> odbc_prepare函数: 预置SQL语句的执行<br> odbc_rollback函数: 撤销所有处于未决状态的操作</li>
<li>ODBC信息获取类函数<br> odbc_columnprivileges函数: 列出给定表的列和相关的权限<br> odbc_columns函数: 列出指定表的列的名称<br> odbc_cursor函数: 获取光标的名称<br> odbc_data_source函数: 返回连接数据库的信息<br> odbc_error函数: 获取最后的错误代码<br> odbc_errormsg函数: 获取最后的错误信息<br> odbc_fetch_array函数: 获取结果集数组<br> odbc_fetch_into函数: 获取传回的指定列<br> odbc_fetch_object函数: 返回结果集到对象<br> odbc_fetch_row函数: 获取传回的一列<br> odbc_field_len函数: 获取字段的长度<br> odbc_field_name函数: 获取字段的名称<br> odbc_field_num函数: 获取字段的序号<br> odbc_field_precision函数: 获取字段的长度<br> odbc_field_scale函数: 获取字段的浮点数<br> odbc_field_type函数: 获取字段的资料类型<br> odbc_foreignkeys函数: 返回特定表的外来键<br> odbc_gettypeinfo函数: 返回数据库的类型信息<br> odbc_longreadlen函数: 设定传回栏的最大值<br> odbc_num_fields函数: 获取字段数目<br> odbc_num_rows函数: 获取传回的列数目<br> odbc_primarykeys函数: 返回列的名字作为表的主键<br> odbc_procedurecolumns函数: 返回检索过程的参数信息<br> odbc_procedures函数: 获取存在于特定数据源中的进程信息<br> odbc_result_all函数: 传回HTML表格信息<br> odbc_result函数: 获取结果数据<br> odbc_specialcolumns函数: 返回一个表中在传送更新时可以自动更新的列<br> odbc_statistics函数: 获取表的状态及其索引<br> odbc_tableprivileges函数: 列出表格和每个表格关联的权限<br> odbc_tables函数: 获取特定数据库上的表的名称<br> odbc_autocommit函数: 开启或关闭自动更新<br> odbc_binmode函数: 设定二进制的数据处理方式<br> odbc_next_result函数: 检查下一个结果集是否可用<br> odbc_setoption函数: 调整ODBC设定</li>
</ol>

  </div>
</article>



      </div>
      
       <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="https://github.com/funsoul">Projects</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Impala的SQL语法参考"><span class="toc-number">1.</span> <span class="toc-text">Impala的SQL语法参考</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP通过Thrift连接Impala"><span class="toc-number">2.</span> <span class="toc-text">PHP通过Thrift连接Impala</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#安装thrift服务"><span class="toc-number">2.1.</span> <span class="toc-text">安装thrift服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#检查是否安装成功"><span class="toc-number">2.2.</span> <span class="toc-text">检查是否安装成功</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#impala的SQL查询参考"><span class="toc-number">2.3.</span> <span class="toc-text">impala的SQL查询参考</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#连接PHP例子参考"><span class="toc-number">2.4.</span> <span class="toc-text">连接PHP例子参考</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使PHP通过ODBC连接Impala-方法1"><span class="toc-number">3.</span> <span class="toc-text">使PHP通过ODBC连接Impala(方法1)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#安装ODBC相关软件包以及ImpalaODBC驱动"><span class="toc-number">3.1.</span> <span class="toc-text">安装ODBC相关软件包以及ImpalaODBC驱动</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#系统版本"><span class="toc-number">3.1.1.</span> <span class="toc-text">系统版本</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用ODBC连接数据库-分为两个主要部分"><span class="toc-number">3.2.</span> <span class="toc-text">使用ODBC连接数据库, 分为两个主要部分:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ClouderaImpalaODBC到Cloudera官网下载"><span class="toc-number">3.3.</span> <span class="toc-text">ClouderaImpalaODBC到Cloudera官网下载:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#若已安装其他版本则先卸载原来安装的"><span class="toc-number">3.4.</span> <span class="toc-text">若已安装其他版本则先卸载原来安装的</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#增加环境变量-注意重启后失效-可在-etc-profile里面改使永久生效"><span class="toc-number">3.5.</span> <span class="toc-text">增加环境变量(注意重启后失效, 可在/etc/profile里面改使永久生效)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#动态编译pdo-odbc扩展"><span class="toc-number">3.6.</span> <span class="toc-text">动态编译pdo-odbc扩展</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#动态编译odbc扩展"><span class="toc-number">3.7.</span> <span class="toc-text">动态编译odbc扩展</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改-etc-odbc-ini替换为如下-注意！！下文所有的配置文件的每行都一定要保持左对齐！"><span class="toc-number">3.8.</span> <span class="toc-text">修改/etc/odbc.ini替换为如下:(注意！！下文所有的配置文件的每行都一定要保持左对齐！)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改-etc-odbcins-ini替换为如下"><span class="toc-number">3.9.</span> <span class="toc-text">修改/etc/odbcins.ini替换为如下:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改-etc-cloudera-impalaodbc-ini"><span class="toc-number">3.10.</span> <span class="toc-text">修改/etc/cloudera.impalaodbc.ini</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#测试连接impala"><span class="toc-number">3.11.</span> <span class="toc-text">测试连接impala</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP通过ODBC连接Impala-方法2"><span class="toc-number">4.</span> <span class="toc-text">PHP通过ODBC连接Impala(方法2)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#安装ODBC相关软件包以及ImpalaODBC驱动-1"><span class="toc-number">4.1.</span> <span class="toc-text">安装ODBC相关软件包以及ImpalaODBC驱动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#新建存放配置的目录"><span class="toc-number">4.2.</span> <span class="toc-text">新建存放配置的目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建环境变量文件common-env"><span class="toc-number">4.3.</span> <span class="toc-text">创建环境变量文件common.env</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建配置odbc-odbc-ini"><span class="toc-number">4.4.</span> <span class="toc-text">创建配置odbc/odbc.ini</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建配置odbc-odbcinst-ini"><span class="toc-number">4.5.</span> <span class="toc-text">创建配置odbc/odbcinst.ini</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建配置odbc-cloudera-impalaodbc-ini"><span class="toc-number">4.6.</span> <span class="toc-text">创建配置odbc/cloudera.impalaodbc.ini</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建配置cloudera-hiveodbc-ini"><span class="toc-number">4.7.</span> <span class="toc-text">创建配置cloudera.hiveodbc.ini</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#进行测试"><span class="toc-number">4.8.</span> <span class="toc-text">进行测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#运行php进行测试"><span class="toc-number">4.9.</span> <span class="toc-text">运行php进行测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#php常用ODBC函数集"><span class="toc-number">5.</span> <span class="toc-text">php常用ODBC函数集</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://funsoul.org/2017/12/08/详解PHP连接Impala安装与配置/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://funsoul.org/2017/12/08/详解PHP连接Impala安装与配置/&text=详解PHP连接Impala安装与配置"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://funsoul.org/2017/12/08/详解PHP连接Impala安装与配置/&title=详解PHP连接Impala安装与配置"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://funsoul.org/2017/12/08/详解PHP连接Impala安装与配置/&is_video=false&description=详解PHP连接Impala安装与配置"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=详解PHP连接Impala安装与配置&body=Check out this article: http://funsoul.org/2017/12/08/详解PHP连接Impala安装与配置/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://funsoul.org/2017/12/08/详解PHP连接Impala安装与配置/&title=详解PHP连接Impala安装与配置"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://funsoul.org/2017/12/08/详解PHP连接Impala安装与配置/&title=详解PHP连接Impala安装与配置"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://funsoul.org/2017/12/08/详解PHP连接Impala安装与配置/&title=详解PHP连接Impala安装与配置"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://funsoul.org/2017/12/08/详解PHP连接Impala安装与配置/&title=详解PHP连接Impala安装与配置"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://funsoul.org/2017/12/08/详解PHP连接Impala安装与配置/&name=详解PHP连接Impala安装与配置&description="><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick='$("#toc-footer").toggle();return false;'><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        <li id="share"><a class="icon" href="#" onclick='$("#share-footer").toggle();return false;'><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick='$("#nav-footer").toggle();return false;'><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

      
      <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2019 funsoul
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="https://github.com/funsoul">Projects</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

      <script src="/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-118289850-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Disqus Comments -->


    </div>
</body>
</html>
